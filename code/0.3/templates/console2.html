<!--
    JSash, a javascript "shell-style" website
    Copyright (C) 2013 Flavio 'darkjoker' Giobergia
 
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
 
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
 
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
<head>
<title>JSash</title>
</head>
<body onLoad = 'initStuff();'>
<style>
.shell {
	width: 100%;
	height: 100%;
	top: 0px;
	left: 0px;
	background: #202020;
	font-size: 11px;
	font-family: Courier;
	color: #DFDFDF;
}


.input {
	background: #202020;
	border: 0px;
	font-size: 11px;
	font-family: Courier;
	color: #DFDFDF;
	outline: none;
	width: 600px;
	left: auto;
	right: 10px;
}

</style>
<div class = 'shell'>
<div id = 'cmdIn'></div>
</div>
<script>

var username = 'darkjoker';
var hostname = 'localhost';
var directory = '~';
var prompt;
var history = Array ();
var histPos = 0;

var promptHTML = "<span id = 'prompt'></span><input id='cmd' type = 'text' class = 'input' autofocus autocomplete='off' maxlength = 85 onBlur='var el = this; setTimeout(function() { el.focus(); }, 0);' onKeyDown='getCmd(event);'>";

// Available directories
var avDirs = Array ('~','~/dir1','~/dir1/subdir1','~/dir1/subdir2','~/dir2','~/dir2/sub1','~/dir2/sub1/deeper','~/dir2/sub2');
// Forbidden directories
var fbDirs = Array ('/','/bin','/dev','/etc','/lib','/opt','/sbin','/sys','/usr','/var');

var filesList = Array ();
filesList['~/README.txt'] = "Welcome on JSash :-)\nFeel free to edit/use this shell.\nP.S.: type 'help' for a list of available commands.\n\ndarkjoker";
filesList['~/wow.txt'] = "Yeah,\n<h1>HTML tags</h1>\nwork as well ;-)";
filesList['~/dir1/random.txt'] = "Random file, ignore it";
filesList['~/dir1/subdir2/txt.esrever'] = ("Gotta love reading backwards :-P".split('').reverse().join(''));
filesList['~/dir1/subdir1/empty.txt'] = "Nope, not actually empty :-O";
filesList['~/dir2/sub1/wntgd.txt'] = "We need to go deeper";
filesList['~/dir2/sub1/deeper/win.txt'] = "Alright, let's be honest:\nWhat exactly were you expecting to find in here?";
filesList['~/dir2/sub2/last.txt'] = "I'm getting bored...\nThis one's the <b>last</b> file I'm creating :-)\nHope you liked JShell!\n\ndarkjoker";


function htmlEntities (str) {
	str = str.replace (/</g,'&lt;');
	return str.replace (/\>/g,'&gt;');
}

function parsePath (path) {

	pattern = /\/[a-z0-9_-]{1,}\.[a-z0-9_-]{1,}$/i;
	if (pattern.test (path)) {
		file = path.substring (path.lastIndexOf('/'));
		path = path.substring (0,path.lastIndexOf('/'));
	}
	else {
		file = '';
	}
	if (path.charAt(path.length-1)!='/') {
		path += '/';
	}
	path = path.replace ('~','/home/'+username);
	path = path.replace(/(\.\/)/g, ''); // ././dir == dir
	// Ora i '.' rappresentano .. (tutti i casini dei file nascosti non li ho inclusi)
	while (path.indexOf('.')!=-1) {
		path = path.substring(0,path.substring(0,path.indexOf('/.')).lastIndexOf('/')) +'/'+path.substring(path.indexOf('/.')+2);
	}
	if (path!='/') {
		path = path.substring (0,path.length-1);
		path += file;
	}
	else {
		if (file) {
			path=file;
		}
	}
	
	return path.replace('/home/'+username,'~');
}

function updatePrompt () {
	prompt = username+'@'+hostname+':'+directory+'$ ';
	document.getElementById('prompt').innerHTML = prompt;	
}

function initStuff () {
	document.title = 'JSash ~ '+username+'@'+hostname;
	prompt = username+'@'+hostname+':'+directory+'$ ';
	document.getElementById('cmdIn').innerHTML = promptHTML;
	document.getElementById('prompt').innerHTML = prompt;
	document.getElementById('cmd').focus(); // "workaround" for firefox (and probably summin' else)
}

function getOutput (cmd) {
	argv = cmd.split(" ");
	argc = argv.length;
	output = '';
	return output.replace(/\n/g,'<br>');
}

function printPrompt (cmd, output) {
	if (cmd && cmd!='clear') {
		line = prompt+cmd+'<br>';
		if (output) {
			line += output+'<br>';
		}
	}
	else {
		line='';
	}
	cmdIn = document.getElementById('cmdIn');

	document.getElementById('cmdIn').innerHTML = cmdIn.innerHTML.substring(0,cmdIn.innerHTML.indexOf('<span'))+line+promptHTML;
	updatePrompt();
	document.getElementById('cmd').focus(); // "workaround" for firefox (and probably summin' else)

}


f
</body>
</html>